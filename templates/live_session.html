<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InsightDeck Agent - Live Research Sessions</title>
    
    <!-- Existing CSS plus new live session styles -->
    <style>
        /* Base styles from existing app */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 0;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        /* Live Session Specific Styles */
        .session-controls {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .session-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .live-transcript {
            background: white;
            border-radius: 12px;
            padding: 20px;
            height: 400px;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .live-insights {
            background: white;
            border-radius: 12px;
            padding: 20px;
            height: 400px;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .transcript-entry {
            margin-bottom: 15px;
            padding: 10px;
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .speaker-name {
            font-weight: bold;
            color: #667eea;
            font-size: 0.9rem;
        }
        
        .timestamp {
            color: #6c757d;
            font-size: 0.8rem;
            float: right;
        }
        
        .insight-item {
            margin-bottom: 12px;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .insight-theme {
            background: #e3f2fd;
            border-left-color: #2196f3;
        }
        
        .insight-emotion {
            background: #f3e5f5;
            border-left-color: #9c27b0;
        }
        
        .insight-action {
            background: #e8f5e8;
            border-left-color: #4caf50;
        }
        
        .session-status {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-live {
            background: #4caf50;
        }
        
        .status-paused {
            background: #ff9800;
        }
        
        .status-stopped {
            background: #f44336;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .visualizations {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .chart-container {
            margin: 20px 0;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 8px;
            color: #6c757d;
        }
        
        .session-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea20, #764ba220);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 12px;
            width: 80%;
            max-width: 600px;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .alert-info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        
        @media (max-width: 768px) {
            .session-grid {
                grid-template-columns: 1fr;
            }
            
            .session-stats {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ InsightDeck Agent</h1>
            <p>Live Research Sessions with ADK Intelligence</p>
        </div>
        
        <!-- Session Controls -->
        <div class="session-controls">
            <div class="session-status">
                <div class="status-indicator status-stopped" id="statusIndicator"></div>
                <span id="statusText">Ready to Start</span>
                <span style="margin-left: auto;" id="sessionTimer">00:00:00</span>
            </div>
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn" id="startSessionBtn" onclick="showNewSessionModal()">
                    üéôÔ∏è Start Live Session
                </button>
                <button class="btn btn-secondary" id="pauseBtn" onclick="pauseSession()" disabled>
                    ‚è∏Ô∏è Pause
                </button>
                <button class="btn btn-danger" id="stopBtn" onclick="stopSession()" disabled>
                    ‚èπÔ∏è Stop Session
                </button>
                <button class="btn btn-success" id="summaryBtn" onclick="generateSummary()" disabled>
                    üìä Generate Summary
                </button>
            </div>
            
            <div class="alert alert-info" style="margin-top: 20px;">
                <strong>üí° ADK Enhanced Features:</strong>
                Real-time speaker diarization, live sentiment analysis, automatic theme detection, and multi-agent insight generation.
            </div>
        </div>
        
        <!-- Live Session Grid -->
        <div class="session-grid">
            <!-- Live Transcript -->
            <div>
                <h3>üé§ Live Transcript</h3>
                <div class="live-transcript" id="liveTranscript">
                    <p style="text-align: center; color: #6c757d; margin-top: 100px;">
                        Start a session to see live transcription...
                    </p>
                </div>
            </div>
            
            <!-- Live Insights -->
            <div>
                <h3>üß† Live Insights</h3>
                <div class="live-insights" id="liveInsights">
                    <p style="text-align: center; color: #6c757d; margin-top: 100px;">
                        AI insights will appear here during the session...
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Session Statistics -->
        <div class="session-stats">
            <div class="stat-card">
                <div class="stat-number" id="speakerCount">0</div>
                <div class="stat-label">Active Speakers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="insightCount">0</div>
                <div class="stat-label">Insights Generated</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="themeCount">0</div>
                <div class="stat-label">Themes Identified</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="actionCount">0</div>
                <div class="stat-label">Action Items</div>
            </div>
        </div>
        
        <!-- Visualizations -->
        <div class="visualizations">
            <h3>üìà Real-Time Analytics</h3>
            <div class="chart-container">
                <p>üìä Theme Frequency Chart<br><small>Chart will populate during session</small></p>
            </div>
            <div class="chart-container">
                <p>üòä Sentiment Timeline<br><small>Real-time emotion tracking</small></p>
            </div>
        </div>
    </div>
    
    <!-- New Session Modal -->
    <div id="newSessionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeNewSessionModal()">&times;</span>
            <h2>üéØ Create New Live Session</h2>
            
            <form id="newSessionForm">
                <div class="form-group">
                    <label for="sessionName">Session Name:</label>
                    <input type="text" id="sessionName" name="sessionName" 
                           placeholder="e.g., User Interview - Mobile App" required>
                </div>
                
                <div class="form-group">
                    <label for="researchType">Research Type:</label>
                    <select id="researchType" name="researchType">
                        <option value="user_interview">User Interview</option>
                        <option value="focus_group">Focus Group</option>
                        <option value="usability_test">Usability Test</option>
                        <option value="stakeholder_meeting">Stakeholder Meeting</option>
                        <option value="design_review">Design Review</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="maxSpeakers">Expected Number of Participants:</label>
                    <select id="maxSpeakers" name="maxSpeakers">
                        <option value="2">2 participants</option>
                        <option value="3">3 participants</option>
                        <option value="4">4 participants</option>
                        <option value="5">5 participants</option>
                        <option value="8">8+ participants (large group)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableDiarization" checked>
                        Enable Speaker Diarization (ADK Enhanced)
                    </label>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableRealTimeInsights" checked>
                        Enable Real-Time AI Insights
                    </label>
                </div>
                
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è ADK Requirements:</strong>
                    Make sure you have configured Google Cloud credentials and Vertex AI access for enhanced features.
                </div>
                
                <button type="submit" class="btn">üöÄ Start Live Session</button>
                <button type="button" class="btn btn-secondary" onclick="closeNewSessionModal()">Cancel</button>
            </form>
        </div>
    </div>
    
    <script>
        // Global variables
        let currentSession = null;
        let sessionWebSocket = null;
        let sessionTimer = null;
        let sessionStartTime = null;
        
        // Demo data for simulation
        const demoTranscripts = [
            { speaker: "Researcher", text: "Welcome! Thanks for joining us today. Can you tell me about your experience with our current app?" },
            { speaker: "Participant", text: "Sure! I've been using it for about 6 months. Overall it's pretty good, but I find the navigation a bit confusing sometimes." },
            { speaker: "Researcher", text: "That's really helpful feedback. Can you walk me through what specifically feels confusing about the navigation?" },
            { speaker: "Participant", text: "Well, when I'm looking for settings, I expect it to be in the top right, but it's buried in a menu. It's not intuitive." },
            { speaker: "Participant", text: "Also, the search function is hard to find. I wish it was more prominent because I use it a lot." },
            { speaker: "Researcher", text: "Interesting. How often do you typically use the search feature?" },
            { speaker: "Participant", text: "Probably daily. It would save me so much time if it was easier to access. Maybe at the top of the screen?" },
            { speaker: "Participant", text: "The app loading time is also quite slow sometimes. Is that normal?" },
            { speaker: "Researcher", text: "Thanks for mentioning that. Are there specific times when it feels particularly slow?" },
            { speaker: "Participant", text: "Usually in the morning when I'm trying to check my daily tasks. It's frustrating when I'm in a hurry." }
        ];
        
        const demoInsights = [
            { type: "theme", content: "Navigation confusion - users expect familiar patterns", confidence: 0.92 },
            { type: "action", content: "Consider relocating settings to top-right corner", confidence: 0.88 },
            { type: "theme", content: "Search functionality needs better visibility", confidence: 0.95 },
            { type: "emotion", content: "User frustration detected with loading times", confidence: 0.85 },
            { type: "action", content: "Investigate performance optimization opportunities", confidence: 0.90 },
            { type: "theme", content: "Daily workflow patterns affecting user experience", confidence: 0.87 }
        ];
        
        // Modal functions
        function showNewSessionModal() {
            document.getElementById('newSessionModal').style.display = 'block';
        }
        
        function closeNewSessionModal() {
            document.getElementById('newSessionModal').style.display = 'none';
        }
        
        // Session management
        document.getElementById('newSessionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            startNewSession();
        });
        
        async function startNewSession() {
            const formData = new FormData(document.getElementById('newSessionForm'));
            const sessionConfig = {
                sessionName: formData.get('sessionName'),
                researchType: formData.get('researchType'),
                maxSpeakers: parseInt(formData.get('maxSpeakers')),
                enableDiarization: document.getElementById('enableDiarization').checked,
                enableRealTimeInsights: document.getElementById('enableRealTimeInsights').checked
            };
            
            try {
                // In real implementation, this would call your Flask API
                // const response = await fetch('/api/live-session', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify(sessionConfig)
                // });
                
                // For demo, simulate session creation
                currentSession = {
                    sessionId: 'demo-' + Date.now(),
                    config: sessionConfig,
                    status: 'live'
                };
                
                closeNewSessionModal();
                updateSessionUI('live');
                startSessionTimer();
                simulateLiveSession();
                
                console.log('Started new session:', currentSession);
                
            } catch (error) {
                console.error('Failed to start session:', error);
                alert('Failed to start session. Please check your configuration.');
            }
        }
        
        function pauseSession() {
            if (currentSession && currentSession.status === 'live') {
                currentSession.status = 'paused';
                updateSessionUI('paused');
                stopSessionTimer();
                
                if (sessionWebSocket) {
                    // Send pause signal
                    sessionWebSocket.send(JSON.stringify({ type: 'pause_session' }));
                }
            }
        }
        
        function stopSession() {
            if (currentSession) {
                currentSession.status = 'stopped';
                updateSessionUI('stopped');
                stopSessionTimer();
                
                if (sessionWebSocket) {
                    sessionWebSocket.close();
                    sessionWebSocket = null;
                }
                
                // Clear the demo simulation
                clearTimeout(window.demoSimulation);
            }
        }
        
        function generateSummary() {
            if (currentSession) {
                // In real implementation, this would request summary from backend
                alert('üéØ Session Summary Generated!\n\nKey Themes:\n‚Ä¢ Navigation confusion\n‚Ä¢ Search visibility issues\n‚Ä¢ Performance concerns\n\nAction Items:\n‚Ä¢ Redesign settings location\n‚Ä¢ Optimize loading times\n‚Ä¢ Enhance search prominence');
            }
        }
        
        // UI Updates
        function updateSessionUI(status) {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const startBtn = document.getElementById('startSessionBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const stopBtn = document.getElementById('stopBtn');
            const summaryBtn = document.getElementById('summaryBtn');
            
            // Update status indicator
            statusIndicator.className = 'status-indicator status-' + status;
            
            switch (status) {
                case 'live':
                    statusText.textContent = 'Live Session Active';
                    startBtn.disabled = true;
                    pauseBtn.disabled = false;
                    stopBtn.disabled = false;
                    summaryBtn.disabled = false;
                    break;
                case 'paused':
                    statusText.textContent = 'Session Paused';
                    startBtn.disabled = false;
                    pauseBtn.disabled = true;
                    stopBtn.disabled = false;
                    summaryBtn.disabled = false;
                    break;
                case 'stopped':
                    statusText.textContent = 'Session Ended';
                    startBtn.disabled = false;
                    pauseBtn.disabled = true;
                    stopBtn.disabled = true;
                    summaryBtn.disabled = false;
                    break;
                default:
                    statusText.textContent = 'Ready to Start';
                    startBtn.disabled = false;
                    pauseBtn.disabled = true;
                    stopBtn.disabled = true;
                    summaryBtn.disabled = true;
            }
        }
        
        // Timer functions
        function startSessionTimer() {
            sessionStartTime = Date.now();
            sessionTimer = setInterval(updateTimer, 1000);
        }
        
        function stopSessionTimer() {
            if (sessionTimer) {
                clearInterval(sessionTimer);
                sessionTimer = null;
            }
        }
        
        function updateTimer() {
            if (sessionStartTime) {
                const elapsed = Date.now() - sessionStartTime;
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                
                document.getElementById('sessionTimer').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        // Live session simulation (for demo purposes)
        function simulateLiveSession() {
            let transcriptIndex = 0;
            let insightIndex = 0;
            
            function addNextTranscript() {
                if (transcriptIndex < demoTranscripts.length && currentSession && currentSession.status === 'live') {
                    const transcript = demoTranscripts[transcriptIndex];
                    addTranscriptEntry(transcript.speaker, transcript.text);
                    transcriptIndex++;
                    
                    // Add insight occasionally
                    if (Math.random() > 0.6 && insightIndex < demoInsights.length) {
                        setTimeout(() => {
                            const insight = demoInsights[insightIndex];
                            addInsightEntry(insight);
                            insightIndex++;
                            updateStats();
                        }, 1000);
                    }
                    
                    // Schedule next transcript
                    window.demoSimulation = setTimeout(addNextTranscript, 3000 + Math.random() * 4000);
                }
            }
            
            // Start the simulation
            setTimeout(addNextTranscript, 2000);
        }
        
        function addTranscriptEntry(speaker, text) {
            const transcriptContainer = document.getElementById('liveTranscript');
            
            // Clear placeholder text
            if (transcriptContainer.children.length === 1 && transcriptContainer.children[0].tagName === 'P') {
                transcriptContainer.innerHTML = '';
            }
            
            const entry = document.createElement('div');
            entry.className = 'transcript-entry';
            entry.innerHTML = `
                <div class="speaker-name">${speaker}</div>
                <div class="timestamp">${new Date().toLocaleTimeString()}</div>
                <div>${text}</div>
            `;
            
            transcriptContainer.appendChild(entry);
            transcriptContainer.scrollTop = transcriptContainer.scrollHeight;
        }
        
        function addInsightEntry(insight) {
            const insightsContainer = document.getElementById('liveInsights');
            
            // Clear placeholder text
            if (insightsContainer.children.length === 1 && insightsContainer.children[0].tagName === 'P') {
                insightsContainer.innerHTML = '';
            }
            
            const entry = document.createElement('div');
            entry.className = `insight-item insight-${insight.type}`;
            
            const typeIcon = {
                'theme': 'üéØ',
                'action': '‚úÖ',
                'emotion': 'üòä'
            }[insight.type] || 'üí°';
            
            const typeLabel = {
                'theme': 'Theme',
                'action': 'Action Item',
                'emotion': 'Emotion'
            }[insight.type] || 'Insight';
            
            entry.innerHTML = `
                <div style="font-weight: bold; font-size: 0.9rem; margin-bottom: 5px;">
                    ${typeIcon} ${typeLabel} (${Math.round(insight.confidence * 100)}% confidence)
                </div>
                <div>${insight.content}</div>
                <div style="font-size: 0.8rem; color: #6c757d; margin-top: 5px;">
                    ${new Date().toLocaleTimeString()}
                </div>
            `;
            
            insightsContainer.appendChild(entry);
            insightsContainer.scrollTop = insightsContainer.scrollHeight;
        }
        
        function updateStats() {
            // Simulate updating statistics
            const speakerCount = document.getElementById('speakerCount');
            const insightCount = document.getElementById('insightCount');
            const themeCount = document.getElementById('themeCount');
            const actionCount = document.getElementById('actionCount');
            
            speakerCount.textContent = Math.min(parseInt(speakerCount.textContent) + Math.floor(Math.random() * 2), 4);
            insightCount.textContent = parseInt(insightCount.textContent) + 1;
            
            if (Math.random() > 0.5) {
                themeCount.textContent = parseInt(themeCount.textContent) + 1;
            }
            
            if (Math.random() > 0.7) {
                actionCount.textContent = parseInt(actionCount.textContent) + 1;
            }
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateSessionUI('stopped');
            console.log('üéØ InsightDeck Agent Live Sessions Ready!');
            console.log('üí° This demo shows ADK-enhanced features including real-time transcription, speaker diarization, and live AI insights.');
        });
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('newSessionModal');
            if (event.target === modal) {
                closeNewSessionModal();
            }
        }
    </script>
</body>
</html>